<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');
        
        @page {
            size: A4 portrait;
            margin: 0;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 0;
            width: 210mm;
            height: 297mm;
            background-color: white; /* bg-white */
            font-family: sans-serif;
            padding: 1.5rem; /* p-4 in outer div + A4 margins */
            display: flex;
            flex-direction: column;
            
            /* Fallback variables */
            --primary-color: #000000;
        }

        /* Outer shadow container simulation */
        .page-container {
            width: 100%;
            height: 100%;
            padding: 1rem; /* p-4 */
            background-color: var(--background-color, white);
        }

        .receipt-container {
            /* h-full w-full flex flex-col p-6 border border-gray-200 bg-white */
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            padding: 1.5rem; /* p-6 */
            border: 1px solid #e5e7eb; /* border-gray-200 */
            background-color: white; /* inner should likely stay white or be customizable? keeping white for receipt look but respecting container bg */
            position: relative;
        }

        .header {
            /* flex justify-between items-start mb-6 */
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1.5rem; /* mb-6 */
        }

        .logo {
            /* h-12 object-contain mb-2 */
            height: 3rem; 
            object-fit: contain;
            margin-bottom: 0.5rem;
        }
        
        .issuer-title-fallback {
             /* text-xl font-bold */
             font-size: 1.25rem;
             font-weight: 700;
             color: var(--primary-color);
        }

        .header-right {
            /* text-right text-xs text-gray-500 */
            text-align: right;
            font-size: 0.75rem;
            color: #6b7280;
        }
        
        .header-right p {
            margin: 0;
            line-height: 1.4;
        }

        .title-bar {
            /* p-3 mb-6 rounded flex justify-between items-center */
            padding: 0.75rem;
            margin-bottom: 1.5rem;
            border-radius: 0.25rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--primary-color);
            color: white;
        }

        .main-title {
            /* font-bold text-lg tracking-wider uppercase */
            font-weight: 700;
            font-size: 1.125rem;
            letter-spacing: 0.05em;
            text-transform: uppercase;
        }

        .title-id {
            /* font-mono text-sm opacity-80 */
            font-family: monospace;
            font-size: 0.875rem;
            opacity: 0.8;
        }

        .bill-section {
            /* flex justify-between mb-6 text-sm */
            display: flex;
            justify-content: space-between;
            margin-bottom: 1.5rem;
            font-size: 0.875rem;
        }

        .label {
            /* text-xs text-gray-400 uppercase font-bold mb-1 */
            font-size: 0.75rem;
            color: #9ca3af;
            text-transform: uppercase;
            font-weight: 700;
            margin-bottom: 0.25rem;
            margin-top: 0;
        }

        .value {
             /* font-bold text-lg text-gray-800 */
             font-weight: 700;
             font-size: 1.125rem;
             color: #1f2937;
             margin: 0;
        }
        
        .sub-value {
             /* text-gray-500 text-xs */
             color: #6b7280;
             font-size: 0.75rem;
             margin: 0;
        }

        .status-badge {
            /* inline-block px-3 py-1 bg-green-100 text-green-700 rounded-full font-bold text-xs */
            display: inline-block;
            padding: 0.25rem 0.75rem;
            background-color: #dcfce7; /* bg-green-100 */
            color: #15803d; /* text-green-700 */
            border-radius: 9999px;
            font-weight: 700;
            font-size: 0.75rem;
        }

        .table-header {
            /* flex justify-between py-2 bg-gray-50 px-3 text-xs font-bold text-gray-500 uppercase rounded-t */
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0.75rem;
            background-color: #f9fafb; /* bg-gray-50 */
            font-size: 0.75rem;
            font-weight: 700;
            color: #6b7280;
            text-transform: uppercase;
            border-top-left-radius: 0.25rem;
            border-top-right-radius: 0.25rem;
            margin-bottom: 0px; 
        }

        .table-row {
            /* flex justify-between py-4 px-3 text-sm */
            display: flex;
            justify-content: space-between;
            padding: 1rem 0.75rem;
            font-size: 0.875rem;
            border-bottom: 1px solid #e5e7eb; /* border-gray-200 */
            margin-bottom: 0.5rem;
        }

        .total-section {
            /* flex justify-end mt-4 mb-auto */
            display: flex;
            justify-content: flex-end;
            margin-top: 1rem;
            margin-bottom: auto; /* Push footer down */
        }
        
        .total-box {
            /* w-1/2 flex justify-between border-t-2 border-gray-800 pt-3 */
            width: 50%;
            display: flex;
            justify-content: space-between;
            border-top: 2px solid #1f2937;
            padding-top: 0.75rem;
        }

        .footer {
            /* border-t border-gray-200 pt-4 mt-4 text-xs text-gray-400 flex justify-between items-end */
            border-top: 1px solid #e5e7eb;
            padding-top: 1rem;
            margin-top: 1rem;
            font-size: 0.75rem;
            color: #9ca3af;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
        }
        
        .qr-footer {
             /* bg-gray-100 flex items-center justify-center text-[10px] p-1 */
             background-color: #f3f4f6;
             padding: 0.25rem;
             display: flex;
             align-items: center;
             justify-content: center;
        }

    </style>
</head>
<body style="--primary-color: {{ primary_color }};">
    <div class="page-container" style="{% if background_base64 %} background-image: url('data:image/png;base64,{{ background_base64 }}'); background-size: cover; background-position: center; background-attachment: fixed;{% endif %} background-color: var(--background-color, white);">
        <div class="receipt-container">
            <div class="header">
                <div>
                   {% if logo_base64 %}
                    <img src="data:image/png;base64,{{ logo_base64 }}" class="logo">
                   {% else %}
                    <p class="issuer-title-fallback">{{ issuer_name }}</p>
                   {% endif %}
                </div>
                <div class="header-right">
                    <p style="font-weight: 700; color: #1f2937; font-size: 1rem;">{{ issuer_name }}</p>
                    <p>{{ custom_text.get('subtitle', 'Payment Receipt') }}</p>
                    <p>{{ issue_date }}</p>
                </div>
            </div>

            <div class="title-bar">
                <span class="main-title">{{ custom_text.get('title', 'PAYMENT RECEIPT') }}</span>
                <span class="title-id">#{{ verification_id[:8].upper() if verification_id else '12345678' }}</span>
            </div>

            <div class="bill-section">
                <div>
                    <p class="label">{{ custom_text.get('bill_to_label', 'Bill To') }}</p>
                    <p class="value">{{ recipient_name }}</p>
                    <p class="sub-value">{{ recipient_email }}</p>
                </div>
                <div style="text-align: right;">
                    <p class="label">{{ custom_text.get('status_label', 'Status') }}</p>
                    <span class="status-badge">{{ custom_text.get('status_value', 'PAID') }}</span>
                </div>
            </div>

            <div>
                <div class="table-header">
                    <span>{{ custom_text.get('desc_label', 'Description') }}</span>
                    <span>{{ custom_text.get('amount_label', 'Amount') }}</span>
                </div>
                <div class="table-row">
                    <span style="font-weight: 500; color: #1f2937;">{{ course_title }}</span>
                    <span class="value" style="color: var(--primary-color);">{{ amount }}</span>
                </div>
            
             {% for key, value in extra_fields.items() %}
                {% if key != 'amount' %}
                <div class="table-row" style="padding-top: 0.5rem; padding-bottom: 0.5rem; border-bottom: 1px dotted #e5e7eb;">
                    <span class="value" style="font-size: 0.875rem; color: #4b5563;">{{ key }}</span>
                    <span class="value" style="font-size: 0.875rem; color: #1f2937;">{{ value }}</span>
                </div>
                {% endif %}
            {% endfor %}
        </div>

        <div class="total-section">
                <div class="total-box">
                     <span style="font-weight: 700; font-size: 1.125rem;">{{ custom_text.get('total_label', 'Total') }}</span>
                     <span style="font-weight: 700; font-size: 1.125rem; color: var(--primary-color);">{{ amount }}</span>
                </div>
            </div>

            <div class="footer">
                <div>
                    <p style="margin:0;">{{ custom_text.get('signature_label', 'Auth Signature') }}: {{ signature if signature else 'Signature' }}</p>
                    <p style="margin-top: 0.25rem; margin-bottom: 0;">{{ custom_text.get('footer_msg', 'Thank you for your business.') }}</p>
                </div>
                <div class="qr-footer">
                    <img src="data:image/png;base64,{{ qr_base64 }}" style="width: 48px; height: 48px;">
                </div>
            </div>
        </div>
    </div>
</body>
</html>
